<!-- 
http://24.69.102.51
CLIENT ID: 	5wf6b3t4dqr0rfbthgkqqlz79yy9rgr 
NAME:		tplyr
SECRET: 	gwiu1cs80y1x5u7h3dubjhrydynrss2
-->
<!DOCTYPE html>
<html lang='en'>
  <head>
	<meta content='text/html; charset=utf-8' http-equiv='content-type'>
	<title>TwitchPlayer</title>
	<link rel='stylesheet' href='main.css'>
	<script src='js/jquery-2.0.3.min.js'></script>
	<script src='js/twitch.min.js'></script>
	<script src='js/jquery.marquee-1.3.1.min.js'></script>
	<script>
		Twitch.init({clientId: '5wf6b3t4dqr0rfbthgkqqlz79yy9rg'}, function(error, status) {
		  if (error) {
			// error encountered while loading
			console.log(error);
		  }
		  // the sdk is now loaded
		  if (status.authenticated) {
			// user is currently logged in
		  }
		  console.log('Twitch API Initialized');
		});
	</script>
	
	<script>
	var leftShow = true;
	var rightShow = true;
	
	if (!String.prototype.format) {
		String.prototype.format = function() {
			var str = this.toString();
			if (!arguments.length)
				return str;
			var args = typeof arguments[0],
				args = (('string' == args || 'number' == args) ? arguments : arguments[0]);
			for (arg in args)
				str = str.replace(RegExp('\\{' + arg + '\\}', 'gi'), args[arg]);
			return str;
		}
	}	
	
	function srlTeamChannels(callback) {
		//'http://api.speedrunslive.com/test/team' 	<--- LIVE DATA
		//'srlJson.json' 							<--- Dev
		$.getJSON('http://api.speedrunslive.com/test/team',function(json){
			srlTeamChannelTable(json);
		});

	}
	
	function srlTeamChannelTable(srlJson, callback) {
		if (srlJson) {
			for (var i = 0; i < 31; i++ ) {
				//console.log(srlJson.channels[i].channel);
				var txt = '';
				var list1 = '';
				var channel = srlJson.channels[i].channel
				var image = '<img width=60 height=60 align=\'left\' src=\' ' +
					channel.image.size70 + '\' alt=min>';
				var list1 = '';
				if (i%2) { 
					list1 = '<li class=\'odd\' value={n}>'.format({n: i})
				} else {
					list1 = '<li class=\'even\' value={n}>'.format({n: i})
				}
				txt += '{opentag}{img1}{name} - {title}{endtag}'.format({
					opentag: list1,
					img1: image,					
					name: '<span style=\'font-size:140%\'>' + channel.display_name + '</span>',
					title: channel.title,
					endtag: '</li>'
					})

				if (txt != '') {
					$('#stream ul').append(txt).removeClass('hidden');
				}
			}			
		}
		
		//This allows fast switching of streams by changing the param in the videoplayer object,
		$('#stream ul li').click(function() {
			data = $(this).text().split(' '); // data[0] or first item is the channel name. the rest of array not needed.
			
			// Create the channel string based on chosen stream.
			flashvars = '<param name=\'flashvars\' value=channel={ch}&start_volume=10&auto_play=true>'.format({
				ch: data[0]});
				
			// Change the video channel via DOM
			$('#videoplayer_embed').find('param[name=\'flashvars\']').replaceWith(flashvars);
			
			// Change the chat to the corresponding video channel.
			chat = 'http://twitch.tv/chat/embed?channel={ch}&amp;popout_chat=true'.format({
				ch: data[0]});
			$('#chat_embed').attr('src', chat);
			
		});	
		
		<!-- Debug -- >
		//var test2 = $('#videoplayer').find('param[name=\'flashvars\']').val();
		//console.log(test2);
		//console.log($('#videoplayer').css('width') + ' by ' + $('#videoplayer').css('height'));
		<!-- End Debug -- >
	}

	/*
	* Creates and returns an object that has resolutions for 3 panels. left, center and right.
	*/
	function calcResolutions() {
		var hOffset = 22; //Height for our header
		var currWinWidth = $(window).width();
		var currWinHeight = $(window).height();
		
		var headerPanelWidth = Math.floor(currWinWidth);
		var headerPanelHeight = Math.floor(hOffset);
		
		var containerWidth = (currWinWidth);
		var containerHeight = (currWinHeight);
		
		var leftPanelWidth = Math.floor(0.12 * currWinWidth);
		var leftPanelHeight = Math.floor(currWinHeight - hOffset);
		
		var rightPanelWidth = Math.ceil(0.18 * currWinWidth);
		var rightPanelHeight = Math.floor(currWinHeight - hOffset);
		
		var centerPanelWidth = Math.floor(0.70 * currWinWidth);
		var centerPanelHeight = Math.floor(currWinHeight - hOffset);
		
		var leftPlusCenterWidth = Math.floor(0.82 * currWinWidth);
		var leftPlusCenterHeight = Math.floor(currWinHeight - hOffset);
		var rightPlusCenterWidth = Math.ceil(0.88 * currWinWidth);
		var rightPlusCenterHeight = Math.floor(currWinHeight - hOffset);
		var centerOnlyWidth = Math.floor(currWinWidth);
		var centerOnlyHeight = Math.floor(currWinHeight - hOffset);
		
		<!-- Debug -->
<!-- 		console.log('left: ' + leftPanelWidth + 'x' + leftPanelHeight); -->
<!-- 		console.log('right: ' + rightPanelWidth + 'x' + rightPanelHeight); -->
<!-- 		console.log('center: ' + centerPanelWidth + 'x' + centerPanelHeight); -->
<!-- 		console.log('leftCenter: ' + leftPlusCenterWidth + 'x' + leftPlusCenterHeight); -->
<!-- 		console.log('rightCenter: ' + rightPlusCenterWidth + 'x' + rightPlusCenterHeight); -->
<!-- 		console.log('centerOnly: ' + centerOnlyWidth + 'x' + centerOnlyHeight); -->
		<!-- End Debug -- >
		
		return {
				containerW: containerWidth, containerH: containerHeight,
				headerW: headerPanelWidth, headerH: headerPanelHeight,
				leftW: leftPanelWidth, leftH: leftPanelHeight,
				rightW: rightPanelWidth, rightH: rightPanelHeight,
				centerW: centerPanelWidth, centerH: centerPanelHeight,
				leftCenterW: leftPlusCenterWidth, leftCenterH: leftPlusCenterHeight,
				rightCenterW: rightPlusCenterWidth, rightCenterH: rightPlusCenterHeight,
				centerOnlyW: centerOnlyWidth, centerOnlyH: centerOnlyHeight
				};
				
	}
	

	
	srlTeamChannels( function(srlJson) {
		srlTeamChannelTable(srlJson);
	});

	function disableVerticalScrolling() {
		$('html, body').css({
			'overflow': 'hidden',
			'height': '100%'
		})	
	}

	function disableHorizontalScrolling() {
		$("jqueryselector").css("overflow-x","hidden"); //hide horizontal scrollbar	
	}

	// Apply panel resolutions based on current window sizes to various divs
	function applyResolutions() {
		res = calcResolutions();
		$('#header').css('width',res.headerW);
		$('#header').css('height',res.headerH);
		if (leftShow) {
			$('#left').css('width', res.leftW);
			$('#left').css('height', res.leftH);		
		}
		if (rightShow) {
			$('#right').css('width', res.rightW);
			$('#right').css('height', res.rightH);		
		}
		if (!leftShow && rightShow) {
			$('#center').css('width', res.leftCenterW);
			$('#center').css('height', res.leftCenterH);			
			$('#videoplayer_embed').css('width', res.leftCenterW);
			$('#videoplayer_embed').css('height', res.leftCenterH);				
		}else if (leftShow && !rightShow) {
			$('#center').css('width', res.rightCenterW);
			$('#center').css('height', res.rightCenterH);	
			$('#videoplayer_embed').css('width', res.rightCenterW);
			$('#videoplayer_embed').css('height', res.rightCenterH);				
		}else if ( (!leftShow && !rightShow) ) {
			$('#center').css('width', res.centerOnlyW);
			$('#center').css('height', res.centerOnlyH);			
			$('#videoplayer_embed').css('width', res.centerOnlyW);
			$('#videoplayer_embed').css('height', res.centerOnlyH);		
		}else if (leftShow && !rightShow) {
			$('#center').css('width', res.rightCenterW);
			$('#center').css('height', res.rightCenterH);	
			$('#videoplayer_embed').css('width', res.rightCenterW);
			$('#videoplayer_embed').css('height', res.rightCenterH);				
		}else {
			$('#center').css('width', res.centerW);
			$('#center').css('height', res.centerH);
			$('#videoplayer_embed').css('width', res.centerW);
			$('#videoplayer_embed').css('height', res.centerH);		
		}
		$('#chat_embed').css('width', res.rightW);
		$('#chat_embed').css('height', res.rightH);
		$('#showhide_right').css('margin-left', res.headerW-48); //Hack to align image to far right properly
	}	

	function showHideLeft() {
		$('#left').toggle();
		leftShow = !leftShow;

		if (!leftShow && rightShow) {
			$('#center').css('width', res.leftCenterW);
			$('#center').css('height', res.leftCenterH);			
			$('#videoplayer_embed').css('width', res.leftCenterW);
			$('#videoplayer_embed').css('height', res.leftCenterH);				
		} 
		if ( (!leftShow && !rightShow) ) {
			$('#center').css('width', res.centerOnlyW);
			$('#center').css('height', res.centerOnlyH);			
			$('#videoplayer_embed').css('width', res.centerOnlyW);
			$('#videoplayer_embed').css('height', res.centerOnlyH);		
		}
		if (leftShow && !rightShow) {
			$('#center').css('width', res.rightCenterW);
			$('#center').css('height', res.rightCenterH);	
			$('#videoplayer_embed').css('width', res.rightCenterW);
			$('#videoplayer_embed').css('height', res.rightCenterH);				
		} 
		if ( leftShow && rightShow) {
			applyResolutions();
		}
		console.log(leftShow);
	}
	
	function showHideRight() {
		$('#right').toggle();
		rightShow = !rightShow;
		
		if (leftShow && !rightShow) {
			$('#center').css('width', res.rightCenterW);
			$('#center').css('height', res.rightCenterH);	
			$('#videoplayer_embed').css('width', res.rightCenterW);
			$('#videoplayer_embed').css('height', res.rightCenterH);				
		} 
		if ( (!leftShow && !rightShow) ) {
			$('#center').css('width', res.centerOnlyW);
			$('#center').css('height', res.centerOnlyH);			
			$('#videoplayer_embed').css('width', res.centerOnlyW);
			$('#videoplayer_embed').css('height', res.centerOnlyH);		
		}
		if (!leftShow && rightShow) {
			$('#center').css('width', res.leftCenterW);
			$('#center').css('height', res.leftCenterH);			
			$('#videoplayer_embed').css('width', res.leftCenterW);
			$('#videoplayer_embed').css('height', res.leftCenterH);				
		} 
		if ( leftShow && rightShow) {
			applyResolutions();
		}
		console.log(rightShow);
	}
	
	$( document ).ready(function() {
		disableVerticalScrolling();
		disableHorizontalScrolling();
		applyResolutions();					// Apply panel resolutions based on current window sizes
		
		$('#showhide_left').click(function(event) {
			showHideLeft();
		});
		
		$('#showhide_right').click(function(event) {
			showHideRight();
		});
	});
	
	$( window ).resize(function() {
		applyResolutions();
	});
/*
	function showDebugResolutions() {
		$('#leftInfoDebug').text(' ( '
					+ $('#left').width() + 'x' + $('#left').height() + ' )');

		$('#rightInfoDebug').text(' ( '
					+ $('#right').width() + 'x' + $('#right').height() + ' )');				
					
		$('#centerInfoDebug').resize(function () {
			$('#centerInfoDebug').text(' ( ' + $('#center').width() 
									 + ' x ' + $('#center').height() + ' )');
		});	
	}		
*/
	</script>
<!--
<style type='text/css'>
	#centerInfoDebug{
		padding:8px;
		border:1px solid blue;
		width:100px;
	}
	
	#leftInfoDebug{
		padding:8px;
		border:1px solid blue;
		width:100px;
	}
	
	#rightInfoDebug{
		padding:8px;
		border:1px solid blue;
		width:100px;
	}
	
	#headerInfoDebug{
		position: absolute;
		padding:8px;
		border:1px solid blue;
		width:100px;
	}
</style>
-->
	</head>
	<body>

		<div id='container'>

		<div id='header' class='hidden'>
			<!-- <div id='headerInfoDebug'></div> -->
			<img id='showhide_left' src='img/32x32_left_right_arrow.png' alt='min'>
			<img id='showhide_right' src='img/32x32_left_right_arrow.png' alt='min'>
		</div>
		
			<div id='left' class='panel hidden'>
<!--				<div id='leftInfoDebug'></div> -->
				<div id='streams'>
					<div id='stream'>
						<ul></ul>
					</div>
				</div>			
			</div>

			<div id='center'>
<!-- 				<div id='centerInfoDebug'></div> -->

				<div id='videoplayer'></div>
					<object bgcolor='#000000' 
					data='http://www.twitch.tv/widgets/archive_embed_player.swf' 
					id='videoplayer_embed' 
					type='application/x-shockwave-flash' 
					width='800'
					height='600' >
					<param name='movie' value='http://www.twitch.tv/widgets/archive_embed_player.swf' />
					<param name='allowScriptAccess' value='always' />
					<param name='allowNetworking' value='all' />
					<param name='allowFullScreen' value='true' />
					<param name='flashvars' value='auto_play=false'/>
					</object>
				</div>

			<div id='right' class='panel hidden'>
				<!-- <div id='rightInfoDebug'></div> -->
				<div id='chatbox'>
					<iframe id='chat_embed'
							frameborder='0'
							scrolling='yes'
							src=''
							width='350'
							height='500'>
					</iframe>
				</div>	
			</div>	
			
		</div>
		<div id='footer-wrapper'>
		  <div id='footer'></div>
		</div>

<!--
		<div id='showhide'>
			<img src='img/32x32_left_right_arrow.png'>
		</div>
-->
	
	</body>
</html>